<!DOCTYPE html>
<html>
    <head>
        <title>TestGame</title>
        <meta charset="UTF8">
        <style>
            body, #game-container {
                box-sizing: border-box;
                padding: 0;
                margin: 0;
            }
            
            #game-container {
                position: absolute;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
            }
        
            /*@keyframes glowflicker {*/
/*    0% {*/
        
/*    }*/
/*    10% {*/
        
/*    }*/
/*    17% {*/
        
/*    }*/
/*}*/

body {
    font-size: 16px;
}

.tm-container {
    /*border: 3px solid green;*/
    
    background: #111;
    color: lightgreen;
    text-shadow: 0 0 8px rgba(60, 255, 60, 0.5);
    font-size: 16px;
    
    font-family: 'Menlo', 'Monaco', 'Bitstream Sans Vera', monospace;
    
    display: flex;
    flex-direction: column;
    align-items: center;
    
    padding: 1em;
}

.tm-gametext {
    /*border: 1px solid red;*/
    
    margin: 2em auto 0 auto;
    max-width: 600px;
}

.tm-userinput-container {
    margin-top: 2em;
    position: relative;
    max-width: 600px;
    width: 100%;
    
    /*border: 1px solid orange;*/
    
    display: flex;
}

.tm-userinput-container:before {
    position: relative;
    content: '> ';
    line-height: 24px;
}

.tm-userinput {
    outline: 0;
    border: 0;
    font-size: 16px;
    line-height: 24px;
    
    margin-left: 10px;
    
    flex-grow: 2;
    
    background: transparent;
    font-family: 'Menlo', 'Monaco', 'Bitstream Sans Vera', monospace;
    
    color: lightgreen;
    opacity: 1;
    
    transition: opacity 200ms;
    
    /*border: 1px solid white;*/
}

.tm-userinput .hidden {
    opacity: 0;
}

.tm-cursor {
    
}
        </style>
    </head>
    <body>
        <div id="game-container"></div>
        <script>
            /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	/****************************
	 *         Core.js
	 ***************************/

	// Bring in the specialized modules.
	const Input = __webpack_require__(1);
	const Inventory = __webpack_require__(2);
	const Scene = __webpack_require__(3);

	// Utils
	const ensureNode = __webpack_require__(4);

	// Define the top-level stuff.
	const Terminator = (function() {
	    
	    /*********************
	     * Private Variables
	     ********************/

	    const elements = {
	        textbox: null,
	        input: null
	    }

	    const state = {
	        game: null
	    }
	    
	    const config = {
	        root: document.body, // Root node to attach to
	        
	        textSpeed: 1, // write speed - 0 for instant

	        cursorBlinkSpeed: 1, // if blinking, how fast?
	        cursorBlink: true, // whether to blink or not.
	        
	        keySounds: true,
	    }
	    
	    /*********************
	     * Private Methods
	     ********************/
	     
	    function _init(game) {
	        // Intialize engine components and start the game.
	        
	        const root = config.root;
	        
	        const text = elements.textbox = document.createElement('div');
	        text.classList.add('tm-gametext');
	        
	        const input = elements.input = document.createElement('input');
	        input.setAttribute('type', 'text');
	        input.classList.add('tm-userinput');
	        
	        const inputcont = document.createElement('div');
	        inputcont.classList.add('tm-userinput-container');
	        
	        while (root.children.length > 0) {
	            root.removeChild(root.children[0]);
	        }
	        
	        root.classList.add('tm-container');
	        
	        root.appendChild(text);
	        inputcont.appendChild(input);
	        root.appendChild(inputcont);
	        
	        // Set up Input object targeting the input element we just created.
	        Input.init(input, config);
	        Scene.init(text, game, config);
	    }
	    
	    Input.onInput(function(val) {
	        // This callback runs when some input is submitted.
	        
	        console.log('Listener on Core received input of ', val);
	    });
	    
	    
	    /*********************
	     * Public Methods
	     ********************/
	     
	    const t = {};

	    t.load = function(game) {
	        if (!game) {
	            throw Error('Cannot .load() without a game to load!');
	        }
	        
	        let gameData = null;

	        if (typeof game === "object") {
	            if (game.hasOwnProperty('game') && game.hasOwnProperty('scenes')) {
	                gameData = game;
	                console.log('Loading '+game.game.title);
	            }
	        }
	        
	        console.log(gameData);
	        state.game = game;
	        _init(gameData);
	    }
	    
	    t.config = function(props) {
	        console.log('Configuring with', props);
	        
	        // Make sure config is an object.
	        if (typeof props === 'object' && !Array.isArray(props)) {
	            
	            // Loop through and overwrite old config with new properties.
	            for (let i in props) {
	                // If user passes in a string, grab the DOM node.
	                config[i] = (i === 'root')
	                    ? ensureNode(props[i])
	                    : props[i];
	            }
	        } else {
	            throw Error('.config() requires an object as the only parameter.');
	        }
	    }
	    
	    // Define Terminator on window.
	    if (window) {
	        window.Terminator = t;
	    }
	})();

/***/ },
/* 1 */
/***/ function(module, exports) {

	/******************************
	 *      --- Input.js ---
	 *****************************/

	// Handle user input and parsing

	module.exports = (function() {
	    
	    let inputIsFocused = false;
	    let inputEl = null;
	    let config = null;
	    
	    const callbacks = [];
	    
	    const pub = {};
	    
	    pub.init = function(elem, masterConfig) {
	        inputEl = elem;
	        config = masterConfig;
	        
	        inputEl.addEventListener('focus', () => inputIsFocused = true);
	        inputEl.addEventListener('blur', () => inputIsFocused = false);
	        
	        window.addEventListener('keydown', function(e) {
	            if (inputIsFocused) {
	                switch(e.key) {
	                    case 'Enter':
	                        for (let i = 0; i < callbacks.length; i++) {
	                            callbacks[i](inputEl.value);
	                        }
	                        break;
	                    case 'Escape':
	                        inputEl.value = '';
	                        break;
	                    default:
	                        break;
	                }
	                
	                if (config.keySounds) {
	                    console.log('click');
	                }
	            }
	        });
	    };
	    
	    pub.onInput = function(callback) {
	        // Register callback which fires every time text input happens.
	        
	        for (let i = 0; i < callbacks.length; i++) {
	            if (callbacks[i] === callback) {
	                console.warn('Did not add callback because it\'s already in the list');
	                return;
	            }
	        }
	        
	        callbacks.push(callback);
	    };
	    
	    return pub;
	})();

/***/ },
/* 2 */
/***/ function(module, exports) {

	/******************************
	 *    --- Inventory.js ---
	 *****************************/

	// Provides an easy way to keep track of
	// what items the player has and retrieve them.

	module.exports = (function() {
	    
	})();

/***/ },
/* 3 */
/***/ function(module, exports) {

	/******************************
	 *      --- Scene.js ---
	 *****************************/

	// Handles the scene list and transitions between scenes.

	module.exports = (function() {
	    let sceneTree = {};
	    let activeScene = {
	        name: null,
	        data: null
	    }
	    let textEl = null;
	    let config = {};
	    
	    function _printSection(name) {
	        activeScene.section = name;
	        
	        if (textEl) {
	            textEl.textContent = activeScene.data.sections[name];
	        }
	        
	        console.log('printing', activeScene.data.sections[name]);
	    }
	    
	    function _runCallbacks(list, params) {
	        for (var i = 0; i < list.length; i++) {
	            list[i].apply(null, params);
	        }
	    }
	    
	    const listeners = [];
	    
	    const s = {};
	    
	    s.init = function(el, gameData, conf) {
	        textEl = el;
	        sceneTree = gameData.scenes;
	        config = conf;
	        
	        s.changeScene(gameData.game.first_scene);
	    }
	    
	    s.changeScene = function(name, section = 'main') {
	        if (sceneTree[name]) {
	            activeScene.name = name;
	            activeScene.data = sceneTree[name];
	            
	            //console.log(section, name);
	            if (activeScene.data.sections[section]) {
	                _printSection(section);
	            }
	            
	            _runCallbacks(listeners, [name, section]);
	        } else {
	            throw Error('Scene '+scene+' does not exist!');
	        }
	    }
	    
	    s.changeSection = function(name) {
	        return s.changeScene(activeScene.name, name);
	    }
	    
	    s.onChange = function(callback) {
	        for (var i = 0; i < sceneListeners.length; i++) {
	            if (sceneListeners[i] === callback) {
	                return false;
	            }
	        }
	        
	        sceneListeners.push(callback);
	    }
	    
	    return s;
	})();

/***/ },
/* 4 */
/***/ function(module, exports) {

	module.exports = function(node) {
	    if (typeof node === 'string') {
	        return document.querySelector(node);
	    }
	    return node;
	}

/***/ }
/******/ ]);
            
            Terminator.config({
                root: "#game-container"
            });
            
            Terminator.load({"game":{"title":"TestGame","shortname":"testgame","first_scene":"first.scene","developer":{"name":"Tony McCoy","url":"http://tonymccoy.me"},"game_version":"0.0.1"},"scenes":{"first.scene":{"scenes":{"one":"first.scene","two":"second.scene","three":"third.scene"},"commands":{"go to two":"(scene two)","look":"(section look_around)","fuck off":"(section fuck_off)"},"aliases":{"look":["look around","examine"]},"sections":{"main":"Hello there. This is the very first scene in the demo game. Hopefully you will be able to go to the next one by typing \"go to two\".","look_around":"You are sitting in a dimly lit room in front of an old, rich mahogany desk. The faint smell of cigars lingers in the air. You hear the chirping of crickets out the window. It is dark out.","fuck_off":"No, u. (wait 2000) (section main)"}},"second.scene":{"scenes":{"three":"third.scene"},"commands":{"go to three":"(scene three)"},"sections":{"main":"Hey, this is scene two! Type \"go to three\" to move to scene three."}},"third.scene":{"scenes":{"one":"first.scene"},"commands":{"back to one":"(scene one)"},"sections":{"main":"This is scene three! Type \"back to one\" to go back to the first scene."}}}});
        </script>
    </body>
</html>